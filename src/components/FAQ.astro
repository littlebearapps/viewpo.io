---
import Section from './Section.astro';
import SectionHeader from './SectionHeader.astro';
import FAQAccordion from './FAQAccordion.svelte';
import { FAQ_ITEMS, HOMEPAGE_FAQ_KEYS } from '@utils/constants';

const homeFAQs = HOMEPAGE_FAQ_KEYS
  .map((key) => FAQ_ITEMS.find((item) => item.question === key))
  .filter((item): item is (typeof FAQ_ITEMS)[number] => item !== undefined);
---

<Section id="faq">
  <SectionHeader
    title="Frequently Asked Questions"
    subtitle="Quick answers to help you decide."
  />

  <div class="max-w-3xl mx-auto reveal reveal-delay-2">
    <FAQAccordion items={homeFAQs} client:visible />

    <!-- Read all FAQs link -->
    <div class="mt-10 text-center">
      <a
        href="/help/faq"
        class="inline-flex items-center gap-2 font-heading font-semibold text-sm text-primary hover:text-primary-hover transition-colors group"
      >
        Read all FAQs
        <svg class="w-4 h-4 transition-transform group-hover:translate-x-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </a>
    </div>
  </div>
</Section>

<!-- FAQPage JSON-LD -->
<script is:inline define:vars={{ homeFAQs }}>
  const schema = {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "dateModified": new Date().toISOString().split('T')[0],
    "mainEntity": homeFAQs.map((item) => ({
      "@type": "Question",
      "name": item.question,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": item.answer,
      },
    })),
  };
  const el = document.createElement('script');
  el.type = 'application/ld+json';
  el.textContent = JSON.stringify(schema);
  document.head.appendChild(el);
</script>
