---
import type { GetStaticPaths } from 'astro';
import BaseLayout from '@layouts/BaseLayout.astro';
import Header from '@components/Header.astro';
import Footer from '@components/Footer.astro';
import Button from '@components/Button.astro';
import Badge from '@components/Badge.astro';
import FAQAccordion from '@components/FAQAccordion.svelte';
import { USE_CASES, type UseCase } from '@/data/use-cases';

export const getStaticPaths: GetStaticPaths = () => {
  return USE_CASES.map((uc) => ({
    params: { slug: uc.slug },
    props: { useCase: uc },
  }));
};

interface Props {
  useCase: UseCase;
}

const { useCase } = Astro.props;
const currentDate = new Date().toISOString().split('T')[0];

const accentMap: Record<string, { text: string; bg: string; border: string; iconBg: string; glowBg: string }> = {
  cyan:    { text: 'text-cyan-400',    bg: 'bg-cyan-400/10',    border: 'border-cyan-400/20',    iconBg: 'bg-cyan-400/10 dark:bg-cyan-400/[0.08]',    glowBg: 'bg-cyan-400/15' },
  violet:  { text: 'text-violet-400',  bg: 'bg-violet-400/10',  border: 'border-violet-400/20',  iconBg: 'bg-violet-400/10 dark:bg-violet-400/[0.08]',  glowBg: 'bg-violet-400/15' },
  orange:  { text: 'text-orange-400',  bg: 'bg-orange-400/10',  border: 'border-orange-400/20',  iconBg: 'bg-orange-400/10 dark:bg-orange-400/[0.08]',  glowBg: 'bg-orange-400/15' },
  teal:    { text: 'text-teal-400',    bg: 'bg-teal-400/10',    border: 'border-teal-400/20',    iconBg: 'bg-teal-400/10 dark:bg-teal-400/[0.08]',    glowBg: 'bg-teal-400/15' },
  emerald: { text: 'text-emerald-400', bg: 'bg-emerald-400/10', border: 'border-emerald-400/20', iconBg: 'bg-emerald-400/10 dark:bg-emerald-400/[0.08]', glowBg: 'bg-emerald-400/15' },
  pink:    { text: 'text-pink-400',    bg: 'bg-pink-400/10',    border: 'border-pink-400/20',    iconBg: 'bg-pink-400/10 dark:bg-pink-400/[0.08]',    glowBg: 'bg-pink-400/15' },
  amber:   { text: 'text-amber-400',   bg: 'bg-amber-400/10',   border: 'border-amber-400/20',   iconBg: 'bg-amber-400/10 dark:bg-amber-400/[0.08]',   glowBg: 'bg-amber-400/15' },
};

const accent = accentMap[useCase.accentColour] ?? accentMap.cyan;
const typeLabel = useCase.type === 'persona' ? 'Who It\'s For' : 'When You Need It';

const faqSchema = {
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  dateModified: currentDate,
  mainEntity: useCase.faqs.map((faq) => ({
    '@type': 'Question',
    name: faq.question,
    acceptedAnswer: {
      '@type': 'Answer',
      text: faq.answer,
    },
  })),
};
---

<BaseLayout title={useCase.metaTitle} description={useCase.metaDescription}>
  <Header slot="header" />

  <div class="relative overflow-x-clip">
    <!-- Ambient glow -->
    <div class="pointer-events-none absolute inset-0" aria-hidden="true">
      <div class={`absolute -top-40 -left-40 w-[600px] h-[600px] rounded-full ${accent.glowBg} blur-[160px] dark:opacity-50`}></div>
      <div class="absolute top-[30%] right-[5%] w-[400px] h-[400px] rounded-full bg-indigo-300/10 blur-[130px] dark:bg-indigo-400/[0.05]"></div>
      <div class={`absolute top-[60%] left-[20%] w-[450px] h-[450px] rounded-full ${accent.glowBg} blur-[140px] dark:opacity-30`}></div>
    </div>

    <!-- Hero -->
    <section class="pt-16 sm:pt-24 pb-12 sm:pb-16">
      <div class="container-wide">
        <!-- Breadcrumb -->
        <nav class="mb-8 text-sm reveal" aria-label="Breadcrumb">
          <a href="/use-cases/" class="text-foreground/50 hover:text-foreground transition-colors">Use Cases</a>
          <span class="text-foreground/30 mx-2">/</span>
          <span class="text-foreground/70">{useCase.title}</span>
        </nav>

        <div class="max-w-3xl">
          <!-- Type badge -->
          <div class="mb-4 reveal">
            <Badge variant="default">
              {typeLabel}
            </Badge>
          </div>

          <!-- Icon -->
          <div class={`w-14 h-14 rounded-2xl ${accent.iconBg} flex items-center justify-center mb-6 reveal reveal-delay-1`}>
            <svg class={`w-7 h-7 ${accent.text}`} fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
              <Fragment set:html={useCase.icon} />
            </svg>
          </div>

          <!-- Title -->
          <h1 class="font-heading font-bold text-3xl sm:text-4xl md:text-5xl text-foreground dark:text-white mb-3 reveal reveal-delay-1">
            {useCase.title}
          </h1>

          <!-- Subtitle -->
          <p class="text-lg text-foreground/60 dark:text-neutral-400 mb-8 reveal reveal-delay-2">
            {useCase.subtitle}
          </p>
        </div>
      </div>
    </section>

    <!-- Pain / Situation -->
    <section class="pb-16 sm:pb-20">
      <div class="container-wide">
        <div class="max-w-3xl">
          <h2 class="font-heading font-bold text-2xl md:text-3xl text-foreground dark:text-white mb-6 reveal">
            {useCase.painTitle}
          </h2>
          {useCase.painContent.map((paragraph, i) => (
            <p class={`text-foreground/65 dark:text-neutral-400 leading-relaxed mb-4 text-base reveal reveal-delay-${Math.min(i + 1, 3)}`}>
              {paragraph}
            </p>
          ))}
        </div>
      </div>
    </section>

    <!-- Solution -->
    <section class="pb-16 sm:pb-20">
      <div class="container-wide">
        <div class="max-w-3xl">
          <h2 class="font-heading font-bold text-2xl md:text-3xl text-foreground dark:text-white mb-6 reveal">
            {useCase.solutionTitle}
          </h2>

          {useCase.solutionIntro && (
            <p class="text-foreground/65 dark:text-neutral-400 leading-relaxed mb-8 text-base reveal reveal-delay-1">
              {useCase.solutionIntro}
            </p>
          )}

          <div class="space-y-4 reveal reveal-delay-1">
            {useCase.solutionSteps.map((step, i) => (
              <div class="flex gap-4 items-start">
                <div class={`flex-shrink-0 w-8 h-8 rounded-full ${accent.iconBg} flex items-center justify-center`}>
                  <span class={`text-sm font-heading font-bold ${accent.text}`}>{i + 1}</span>
                </div>
                <p class="text-foreground/70 dark:text-neutral-300 leading-relaxed pt-1">
                  {step.text}
                </p>
              </div>
            ))}
          </div>
        </div>
      </div>
    </section>

    <!-- Features Table -->
    <section class="pb-16 sm:pb-20">
      <div class="container-wide">
        <div class="max-w-3xl">
          <h2 class="font-heading font-bold text-2xl md:text-3xl text-foreground dark:text-white mb-8 reveal">
            {useCase.featuresTitle}
          </h2>

          <!-- Desktop: table -->
          <div class="hidden sm:block reveal reveal-delay-1">
            <div class="rounded-xl border border-neutral-200 dark:border-neutral-800 overflow-hidden">
              <table class="w-full text-sm">
                <thead>
                  <tr class="bg-foreground/[0.03] dark:bg-white/[0.03]">
                    <th class="text-left px-5 py-3 font-heading font-semibold text-foreground dark:text-white">Feature</th>
                    <th class="text-left px-5 py-3 font-heading font-semibold text-foreground dark:text-white">How It's Used</th>
                  </tr>
                </thead>
                <tbody>
                  {useCase.features.map((row) => (
                    <tr class="border-t border-neutral-200 dark:border-neutral-800">
                      <td class={`px-5 py-3.5 font-medium ${accent.text} whitespace-nowrap`}>{row.feature}</td>
                      <td class="px-5 py-3.5 text-foreground/65 dark:text-neutral-400">{row.description}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>

          <!-- Mobile: stacked cards -->
          <div class="sm:hidden space-y-3 reveal reveal-delay-1">
            {useCase.features.map((row) => (
              <div class="rounded-xl border border-neutral-200 dark:border-neutral-800 p-4">
                <p class={`font-heading font-semibold text-sm ${accent.text} mb-1`}>{row.feature}</p>
                <p class="text-sm text-foreground/60 dark:text-neutral-400 leading-relaxed">{row.description}</p>
              </div>
            ))}
          </div>
        </div>
      </div>
    </section>

    <!-- Workflow Timeline -->
    <section class="pb-16 sm:pb-20">
      <div class="container-wide">
        <div class="max-w-3xl">
          <h2 class="font-heading font-bold text-2xl md:text-3xl text-foreground dark:text-white mb-8 reveal">
            {useCase.workflowTitle}
          </h2>

          <div class="rounded-xl border border-neutral-200 dark:border-neutral-800 bg-foreground/[0.02] dark:bg-white/[0.02] overflow-hidden reveal reveal-delay-1">
            <div class="p-5 sm:p-6 space-y-0">
              {useCase.workflow.map((entry, i) => (
                <div class="flex gap-4 items-start py-2">
                  {entry.time ? (
                    <span class="flex-shrink-0 w-20 text-xs font-mono font-medium text-foreground/40 dark:text-neutral-500 pt-0.5 text-right">
                      {entry.time}
                    </span>
                  ) : (
                    <span class="flex-shrink-0 w-20"></span>
                  )}
                  <div class="flex-shrink-0 w-px bg-neutral-200 dark:bg-neutral-700 self-stretch relative">
                    <div class={`absolute top-2 left-1/2 -translate-x-1/2 w-2 h-2 rounded-full ${entry.time ? accent.bg + ' border ' + accent.border : 'bg-neutral-300 dark:bg-neutral-600'}`}></div>
                  </div>
                  <p class="text-sm text-foreground/70 dark:text-neutral-300 leading-relaxed">
                    {entry.action}
                  </p>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Comparison Table (conditional) -->
    {useCase.comparison && (
      <section class="pb-16 sm:pb-20">
        <div class="container-wide">
          <div class="max-w-3xl">
            <h2 class="font-heading font-bold text-2xl md:text-3xl text-foreground dark:text-white mb-8 reveal">
              {useCase.comparison.title}
            </h2>

            <div class="rounded-xl border border-neutral-200 dark:border-neutral-800 overflow-x-auto reveal reveal-delay-1">
              <table class="w-full text-sm min-w-[500px]">
                <thead>
                  <tr class="bg-foreground/[0.03] dark:bg-white/[0.03]">
                    <th class="text-left px-5 py-3 font-heading font-semibold text-foreground dark:text-white"></th>
                    {useCase.comparison.headers.map((header) => (
                      <th class="text-left px-5 py-3 font-heading font-semibold text-foreground dark:text-white">{header}</th>
                    ))}
                  </tr>
                </thead>
                <tbody>
                  {useCase.comparison.rows.map((row) => {
                    const isViewpo = row.label.toLowerCase().includes('viewpo');
                    return (
                      <tr class:list={['border-t border-neutral-200 dark:border-neutral-800', isViewpo && `${accent.bg}`]}>
                        <td class:list={['px-5 py-3.5 font-medium whitespace-nowrap', isViewpo ? `${accent.text} font-semibold` : 'text-foreground dark:text-white']}>
                          {row.label}
                        </td>
                        {row.cells.map((cell) => (
                          <td class:list={['px-5 py-3.5', isViewpo ? 'text-foreground dark:text-white font-medium' : 'text-foreground/65 dark:text-neutral-400']}>
                            {cell}
                          </td>
                        ))}
                      </tr>
                    );
                  })}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
    )}

    <!-- Cross-References -->
    <section class="pb-16 sm:pb-20">
      <div class="container-wide">
        <div class="max-w-3xl">
          <h2 class="font-heading font-bold text-2xl md:text-3xl text-foreground dark:text-white mb-8 reveal">
            {useCase.crossRefTitle}
          </h2>

          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 reveal reveal-delay-1">
            {useCase.crossRefs.map((ref) => {
              const refAccent = accentMap[ref.accentColour] ?? accentMap.cyan;
              return (
                <a
                  href={`/use-cases/${ref.slug}/`}
                  class={`group block rounded-xl border border-neutral-200 dark:border-neutral-700/50 bg-white/50 dark:bg-neutral-900/40 backdrop-blur-sm p-5 transition-all duration-300 hover:shadow-lg hover:bg-white/70 dark:hover:bg-neutral-900/60 hover:scale-[1.01] hover:${refAccent.border}`}
                >
                  <p class={`font-heading font-bold text-sm ${refAccent.text} mb-1`}>{ref.label}</p>
                  <p class="text-sm text-foreground/55 dark:text-neutral-400 leading-relaxed">{ref.hook}</p>
                  <span class="inline-flex items-center gap-1 text-xs font-medium text-foreground/40 dark:text-neutral-500 mt-3 group-hover:text-foreground/60 dark:group-hover:text-neutral-300 transition-colors">
                    Read more
                    <svg class="w-3 h-3 transition-transform group-hover:translate-x-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
                    </svg>
                  </span>
                </a>
              );
            })}
          </div>
        </div>
      </div>
    </section>

    <!-- FAQ -->
    <section class="pb-16 sm:pb-20">
      <div class="container-wide">
        <div class="max-w-3xl">
          <h2 class="font-heading font-bold text-2xl md:text-3xl text-foreground dark:text-white mb-8 reveal">
            Frequently Asked Questions
          </h2>

          <div class="reveal reveal-delay-1">
            <FAQAccordion items={useCase.faqs} client:visible />
          </div>
        </div>
      </div>
    </section>

    <!-- CTA -->
    <section class="pb-20 sm:pb-28">
      <div class="container-wide">
        <div class="max-w-2xl mx-auto text-center reveal">
          <h2 class="font-heading font-bold text-2xl md:text-3xl text-foreground dark:text-white mb-4">
            Ready to try Viewpo?
          </h2>
          <p class="text-foreground/60 dark:text-neutral-400 text-lg mb-8 leading-relaxed">
            Join the beta and preview every deploy at any resolution â€” from your iPhone, iPad, or Mac.
          </p>
          <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
            <button
              type="button"
              data-open-signup
              class="inline-flex items-center justify-center gap-2 font-heading font-medium rounded-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 hover:scale-[1.02] active:scale-[0.98] px-7 py-3.5 text-base bg-primary text-white hover:bg-primary-hover focus:ring-primary shadow-md hover:shadow-lg plausible-event-name=CTA+UseCase+Join+Beta"
            >
              Join the Beta
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3" />
              </svg>
            </button>
            <Button href="/use-cases/" variant="ghost" size="md">
              View All Use Cases
            </Button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- FAQ Schema -->
  <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />

  <Footer slot="footer" />
</BaseLayout>
